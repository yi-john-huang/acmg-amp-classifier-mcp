apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

metadata:
  name: mcp-acmg-amp-server
  annotations:
    config.kubernetes.io/local-config: "true"

namespace: mcp-acmg-amp

resources:
- namespace.yaml
- configmap.yaml
- secrets.yaml
- postgresql.yaml
- redis.yaml
- mcp-server.yaml
- ingress.yaml
- hpa.yaml
- monitoring.yaml

commonLabels:
  app.kubernetes.io/name: mcp-acmg-amp-server
  app.kubernetes.io/instance: production
  app.kubernetes.io/version: "1.0.0"
  app.kubernetes.io/managed-by: kustomize

images:
- name: mcp-acmg-amp-server
  newTag: latest

configMapGenerator:
- name: mcp-deployment-info
  literals:
  - DEPLOYMENT_DATE=$(date -u +"%Y-%m-%dT%H:%M:%SZ")
  - DEPLOYMENT_VERSION=1.0.0
  - DEPLOYMENT_ENVIRONMENT=production

secretGenerator:
- name: mcp-runtime-secrets
  type: Opaque
  literals:
  - DEPLOYMENT_KEY=$(openssl rand -base64 32)

# Patches for different environments
patchesStrategicMerge:
- |-
  apiVersion: apps/v1
  kind: Deployment
  metadata:
    name: mcp-acmg-amp-server
    namespace: mcp-acmg-amp
  spec:
    template:
      metadata:
        annotations:
          deployment.kubernetes.io/revision: "1"
      spec:
        containers:
        - name: mcp-server
          env:
          - name: DEPLOYMENT_ENVIRONMENT
            value: "production"

# Resource transformers
replicas:
- name: mcp-acmg-amp-server
  count: 3

# Generators for additional resources
generators:
- |-
  apiVersion: builtin
  kind: ConfigMapGenerator
  metadata:
    name: environment-config
  literals:
  - NODE_ENV=production
  - LOG_LEVEL=info